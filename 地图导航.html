<!DOCTYPE html>
<html lang="zh">

<head>
    <script type="text/javascript"></script>
    <meta charset="UTF-8">
    <title>å¸…å¸…[å¾®ä¿¡ï¼šyanyeshuai]</title>
</head>

<script>
    var ClickCount = 0; //ç‚¹å‡»æ¬¡æ•°å˜é‡
    var StartX, StartY, EndX, EndY; //å¼€å§‹ç»“æŸåæ ‡å˜é‡
    var DisX, DisY, Dis; //è·ç¦»å˜é‡
    var LineColor //ç”»çº¿é¢œè‰²å˜é‡
    var Maps //åœ°å›¾è·¯å¾„å˜é‡
    var MapsWH = {'2024å°å­¦ç»„.jpg':[1181,571], '2023å°å­¦ç»„.jpg':[1181,571], '2023ä¸­å­¦ç»„.jpg':[1181,571], '2023é«˜ä¸­ç»„.jpg':[1181,571], 'åƒåœ¾åˆ†ç±».jpg':[1200,600], '2022å°å­¦ç»„.jpg':[1181,571]}

    //ç‚¹å‡»'æäº¤'æŒ‰é’®æ—¶è§¦å‘è¯¥å‡½æ•°
    function æäº¤() {
        //é€šè¿‡æ§ä»¶è·å–åœ°å›¾å’Œé¢œè‰²
        LineColor = document.getElementById('Linecolor').value;
        Maps = document.getElementById('Maps').value;
        var canvas = document.getElementById('canvas');
        canvas.width = MapsWH[Maps][0];
        canvas.height = MapsWH[Maps][1];

        //åŠ è½½åœ°å›¾
        var ctx = document.getElementById("canvas").getContext('2d');
        ctx.clearRect(0, 0, 1200, 600);
        var img = new Image();
        img.src = Maps;
        img.onload = function () {
            ctx.drawImage(img, 0, 0, MapsWH[Maps][0], MapsWH[Maps][1]);
        }
        ctx.shadowBlur = 20;
        ctx.shadowColor = "black";

        //åœ°å›¾ç‚¹å‡»å‡½æ•°
        document.getElementById('canvas').onclick = function (e) {
            ClickCount = ClickCount + 1; //ç‚¹å‡»æ—¶ ç‚¹å‡»æ¬¡æ•°å˜é‡+1
            e = e || window.event;
            var x = e.offsetX || e.layerX,
                y = e.offsetY || e.layerY; //æ¥æ”¶ç‚¹å‡»åœ°å›¾çš„ä½ç½®XY

            //ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶å…ˆæ¸…ç©ºå±å¹•ï¼Œåœ¨ç‚¹å‡»ä½ç½®æ˜¾ç¤ºè“è‰²æ–¹å—
            if (ClickCount == 1) {
                ctx.clearRect(0, 0, 1200, 600);
                ctx.drawImage(img, 0, 0, MapsWH[Maps][0], MapsWH[Maps][1]);

                //è®°å½•ç¬¬ä¸€æ¬¡ç‚¹å‡»ä½ç½®
                StartX = x;
                StartY = y;
                ctx.fillStyle = "Blue";
                ctx.fillRect(x - 5, y - 5, 10, 10);
            }

            //ç¬¬äºŒæ¬¡ç‚¹å‡»æ—¶æ˜¾ç¤ºçº¢è‰²æ–¹å—ï¼Œå¹¶è¿çº¿
            if (ClickCount == 2) {
                //è®°å½•ç¬¬äºŒæ¬¡ç‚¹å‡»ä½ç½®
                EndX = x;
                EndY = y;
                ctx.fillStyle = "Red";
                ctx.fillRect(x - 5, y - 5, 10, 10);

                //ç”»çº¿
                ctx.lineWidth = 2;
                ctx.strokeStyle = LineColor;
                ctx.beginPath();
                ctx.moveTo(StartX, StartY);
                ctx.lineTo(StartX, EndY);
                ctx.lineTo(EndX, EndY);
                ctx.closePath();
                ctx.stroke();

                //ç‚¹å‡»æ¬¡æ•°å½’é›¶å¹¶è®¡ç®—è·ç¦»
                ClickCount = 0;
                DisX = Math.abs((StartX - EndX) * 2);
                DisY = Math.abs((StartY - EndY) * 2);
                Dis = Math.abs(Math.sqrt(DisX * DisX + DisY * DisY));
                Dis = Dis.toFixed(2)

                //æ˜¾ç¤ºè·ç¦»æ–‡æœ¬
                ctx.lineWidth = 1;
                ctx.font = "20px å¾®è½¯é›…é»‘ ";
                ctx.strokeText('æ¨ªï¼š' + DisX + 'mm', StartX + (EndX - StartX) / 2 - 30, EndY - 10);
                ctx.strokeText('çºµï¼š' + DisY + 'mm', StartX - 30, StartY + (EndY - StartY) / 2);
                ctx.strokeText('ç›´çº¿ï¼š' + Dis + 'mm', StartX + (EndX - StartX) / 2 - 30, StartY + (EndY - StartY) / 2 -
                    10);
                // console.log("èµ·ç‚¹"+StartX);
                // console.log("æ¨ª"+DisX);
                // console.log(DisX/2);
                // console.log(StartX+DisX/2);

                //è®¡ç®—è§’åº¦
                StartDeg = Math.asin(Math.abs(DisX / Dis)) * 180 / Math.PI;
                EndDeg = Math.asin(Math.abs(DisY / Dis)) * 180 / Math.PI;
                StartDeg = StartDeg.toFixed(2);
                EndDeg = EndDeg.toFixed(2);

                //æ˜¾ç¤ºè§’åº¦æ–‡æœ¬
                ctx.strokeText(StartDeg + 'Â°', StartX, StartY)
                ctx.strokeText(EndDeg + 'Â°', EndX, EndY)

                //åœ¨è¡¨æ ¼ä¸­æ˜¾ç¤º
                document.getElementById("dis").innerHTML = Dis + 'mm';
                document.getElementById("dis_x").innerHTML = DisX + 'mm';
                document.getElementById("dis_y").innerHTML = DisY + 'mm';
                document.getElementById("startDeg").innerHTML = StartDeg + 'Â°';
                document.getElementById("endDeg").innerHTML = EndDeg + 'Â°';
            }
        }

    }


    // window.onload = function () {
    //     var ctx = document.getElementById("canvas").getContext('2d');
    //     var img = new Image();
    //     img.src = Maps;
    //     img.onload = function () {
    //         ctx.drawImage(img, 0, 0, 1180, 571.5);
    //     }
    // }
</script>

<body style="border-radius: 10px; border: 5px solid #8AC007;">
    <div style="text-align:center; vertical-align:middle; ">
        <h1>åœ°å›¾æµ‹é‡å·¥å…·</h1>
        <p>é€‰æ‹©åœ°å›¾å’Œç”»çº¿é¢œè‰²ä»¥åï¼Œç‚¹å‡»â€æäº¤â€œæŒ‰é’®å¼€å§‹æµ‹é‡ï¼</p>

        <form action="">
            åœ°å›¾:
            <select id="Maps">
                <option value="2024å°å­¦ç»„.jpg" selected>2024å°å­¦ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2023å°å­¦ç»„.jpg">2023å°å­¦ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2023ä¸­å­¦ç»„.jpg">2023åˆä¸­ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2023é«˜ä¸­ç»„.jpg">2023é«˜ä¸­ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2022å°å­¦ç»„.jpg">2022å°å­¦ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2022ä¸­å­¦ç»„.jpg">2022åˆä¸­ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="2022é«˜ä¸­ç»„.jpg">2022é«˜ä¸­ç»„(æ‰“å°80ä¸€å¼ åŒ…é‚®)</option>
                <option value="åƒåœ¾åˆ†ç±».jpg">ä¸­é¸£-åƒåœ¾åˆ†ç±»</option>
            </select>
            çº¿é¢œè‰²:<input type="color" id="Linecolor" value="#fb00ff">
            <input type="button" name="" value="æäº¤" onclick="æäº¤()">
        </form>

        <canvas id="canvas" style="border-radius: 10px; border: 2px solid #8AC007;" width="1200"
            height="600"></canvas>
        <p> </p>
        <table border="3"
            style="text-align:center; vertical-align:middle; margin:auto; border-radius: 10px; border: 5px solid #8AC007;">
            <p> æ‰¿æ¥æ•™å¸ˆç«èµ›æŠ€æœ¯åŸ¹è®­ï¼Œæ–¹æ¡ˆï¼ŒEV3æ¨¡å—å®šåˆ¶ï¼Œç«èµ›åœ°å›¾æ‰“å°ç­‰ä¸šåŠ¡ï¼Œéœ€è¦è¯·å¾®ä¿¡è”ç³»ğŸ’•</p>
            <tr>
                <td>æ¨ªå‘è·ç¦»</td>
                <td>çºµå‘è·ç¦»</td>
                <td>è·ç¦»</td>
                <td>å¼€å§‹ç‚¹è§’åº¦</td>
                <td>ç»“æŸç‚¹è§’åº¦</td>
            </tr>
            <tr>
                <td id='dis_x'> æ¨ªå‘è·ç¦» </td>
                <td id='dis_y'> çºµå‘è·ç¦» </td>
                <td id='dis'> è·ç¦» </td>
                <td id='startDeg'>å¼€å§‹ç‚¹è§’åº¦</td>
                <td id='endDeg'>ç»“æŸç‚¹è§’åº¦</td>
            </tr>
        </table>
        <p> å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦ï¼Œè¯·è”ç³»å¸…å¸…[å¾®ä¿¡ï¼šyanyeshuai]</p>
    </div>
</body>

</html>
